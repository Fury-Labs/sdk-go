syntax = "proto3";
package injective.exchange.v1beta1;

import "google/api/annotations.proto";
import "injective/exchange/v1beta1/exchange.proto";
import "injective/exchange/v1beta1/genesis.proto";
import "gogoproto/gogo.proto";


option go_package = "github.com/InjectiveLabs/injective-core/injective-chain/modules/exchange/types";

// Query defines the gRPC querier service.
service Query {

  // Retrieves exchange params
  rpc QueryExchangeParams(QueryExchangeParamsRequest) returns (QueryExchangeParamsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/exchangeParams";
  }

  // Retrieves a Subaccount's Deposits
  rpc SubaccountDeposits(QuerySubaccountDepositsRequest) returns (QuerySubaccountDepositsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/exchange/subaccountDeposits";
  }

  // Retrieves a Subaccount's Deposits
  rpc SubaccountDeposit(QuerySubaccountDepositRequest) returns (QuerySubaccountDepositResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/exchange/subaccountDeposit";
  }

  // Retrieves all of the balances of all users on the exchange.
  rpc ExchangeBalances(QueryExchangeBalancesRequest) returns (QueryExchangeBalancesResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/exchange/exchangeBalances";
  }

  // Retrieves a list of spot markets.
  rpc SpotMarkets(QuerySpotMarketsRequest) returns (QuerySpotMarketsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/spot/markets";
  }

  // Retrieves a spot market by ticker
  rpc SpotMarket(QuerySpotMarketRequest) returns (QuerySpotMarketResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/spot/markets/{market_id}";
  }

  // Retrieves a spot market's orderbook by marketID
  rpc SpotOrderbook(QuerySpotOrderbookRequest) returns (QuerySpotOrderbookResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/spot/orderbook/{market_id}";
  }

  // Retrieves a trader's spot orders
  rpc TraderSpotOrders(QueryTraderSpotOrdersRequest) returns (QueryTraderSpotOrdersResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/spot/orders/{market_id}/{subaccount_id}";
  }

  // Retrieves a derivative market's orderbook by marketID
  rpc DerivativeOrderbook(QueryDerivativeOrderbookRequest) returns (QueryDerivativeOrderbookResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/derivative/orderbook/{market_id}";
  }

  // Retrieves a trader's derivative orders
  rpc TraderDerivativeOrders(QueryTraderDerivativeOrdersRequest) returns (QueryTraderDerivativeOrdersResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/derivative/orders/{market_id}/{subaccount_id}";
  }

  // Retrieves a list of derivative markets.
  rpc DerivativeMarkets(QueryDerivativeMarketsRequest) returns (QueryDerivativeMarketsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/derivative/markets";
  }

  // Retrieves a derivative market by ticker
  rpc DerivativeMarket(QueryDerivativeMarketRequest) returns (QueryDerivativeMarketResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/derivative/markets/{market_id}";
  }

  // Retrieves a derivative market's corresponding address for fees that contribute to the market's insurance fund
  rpc DerivativeMarketAddress(QueryDerivativeMarketAddressRequest) returns (QueryDerivativeMarketAddressResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/derivative/market_address/{market_id}";
  }

  // Retrieves a subaccount's trade nonce
  rpc SubaccountTradeNonce(QuerySubaccountTradeNonceRequest) returns (QuerySubaccountTradeNonceResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/exchange/{subaccount_id}";
  }

  // Retrieves the entire exchange module's state
  rpc ExchangeModuleState(QueryModuleStateRequest) returns (QueryModuleStateResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/module_state";
  }

  // Retrieves the entire exchange module's positions
  rpc Positions(QueryPositionsRequest) returns (QueryPositionsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/positions";
  }

  // Retrieves subaccount's positions
  rpc SubaccountPositions(QuerySubaccountPositionsRequest) returns (QuerySubaccountPositionsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/positions/{subaccount_id}";
  }

  // Retrieves subaccount's order metadata
  rpc SubaccountOrderMetadata(QuerySubaccountOrderMetadataRequest) returns (QuerySubaccountOrderMetadataResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/order_metadata/{subaccount_id}";
  }

  // Retrieves the account and total trade rewards points
  rpc TradeRewardPoints(QueryTradeRewardPointsRequest) returns (QueryTradeRewardPointsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/trade_reward_points";
  }

  // Retrieves the pending account and total trade rewards points
  rpc PendingTradeRewardPoints(QueryTradeRewardPointsRequest) returns (QueryTradeRewardPointsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/pending_trade_reward_points";
  }

  // Retrieves the trade reward campaign
  rpc TradeRewardCampaign(QueryTradeRewardCampaignRequest) returns (QueryTradeRewardCampaignResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/trade_reward_campaign";
  }

  // Retrieves the account's fee discount info
  rpc FeeDiscountAccountInfo(QueryFeeDiscountAccountInfoRequest) returns (QueryFeeDiscountAccountInfoResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/fee_discount_account_info/{account}";
  }

  // Retrieves the fee discount schedule
  rpc FeeDiscountSchedule(QueryFeeDiscountScheduleRequest) returns (QueryFeeDiscountScheduleResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/fee_discount_schedule";
  }

  // Retrieves mismatches between available vs. total balance
  rpc BalanceMismatches(QueryBalanceMismatchesRequest) returns (QueryBalanceMismatchesResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/balance_mismatches/{dust_factor}";
  }

  // Retrieves available and total balances with balance holds
  rpc BalanceWithBalanceHolds(QueryBalanceWithBalanceHoldsRequest) returns (QueryBalanceWithBalanceHoldsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/balances_with_balance_holds";
  }

  // Retrieves fee discount tier stats
  rpc FeeDiscountTierStatistics(QueryFeeDiscountTierStatisticsRequest) returns (QueryFeeDiscountTierStatisticsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/fee_discount_tier_stats";
  }

  // Retrieves if the account is a registered DMM
  rpc IsRegisteredDMM(QueryIsRegisteredDMMRequest) returns (QueryIsRegisteredDMMResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/is_registered_dmm/{account}";
  }

  // Retrieves all registered DMMs
  rpc RegisteredDMMs(QueryRegisteredDMMsRequest) returns (QueryRegisteredDMMsResponse) {
    option (google.api.http).get = "/injective/exchange/v1beta1/registered_dmms";
  }
}

message Subaccount {
  string trader = 1;
  uint32 subaccount_nonce = 2;
}

message SubaccountOrderbookMetadataWithMarket {
  SubaccountOrderbookMetadata metadata = 1;
  string market_id = 2;
  bool isBuy = 3;
}

// QueryExchangeParamsRequest is the request type for the Query/ExchangeParams RPC method.
message QueryExchangeParamsRequest {}

// QueryExchangeParamsRequest is the response type for the Query/ExchangeParams RPC method.
message QueryExchangeParamsResponse {
  Params params = 1 [
    (gogoproto.nullable) = false
  ];
}

// QuerySubaccountDepositsRequest is the request type for the Query/SubaccountDeposits RPC method.
message QuerySubaccountDepositsRequest {
  string subaccount_id = 1;
  Subaccount subaccount = 2[
    (gogoproto.nullable) = true
  ];
}

// QuerySubaccountDepositsResponse is the response type for the Query/SubaccountDeposits RPC method.
message QuerySubaccountDepositsResponse {
  map<string, Deposit> deposits = 1;
}

// QueryExchangeBalancesRequest is the request type for the Query/ExchangeBalances RPC method.
message QueryExchangeBalancesRequest {}

// QuerySubaccountDepositsResponse is the response type for the Query/SubaccountDeposits RPC method.
message QueryExchangeBalancesResponse {
  repeated Balance balances = 1 [
    (gogoproto.nullable) = false
  ];
}

// QuerySubaccountDepositsRequest is the request type for the Query/SubaccountDeposits RPC method.
message QuerySubaccountDepositRequest {
  string subaccount_id = 1;
  string denom = 2;
}

// QuerySubaccountDepositsResponse is the response type for the Query/SubaccountDeposits RPC method.
message QuerySubaccountDepositResponse {
  Deposit deposits = 1;
}

// QuerySpotMarketsRequest is the request type for the Query/SpotMarkets RPC method.
message QuerySpotMarketsRequest {
  // Status of the market, for convenience it is set to string - not enum
  string status = 1;
}

// QuerySpotMarketsResponse is the response type for the Query/SpotMarkets RPC method.
message QuerySpotMarketsResponse {
  repeated SpotMarket markets = 1;
}

// QuerySpotMarketRequest is the request type for the Query/SpotMarket RPC method.
message QuerySpotMarketRequest {
  // Market ID for the market
  string market_id = 1;
}

// QuerySpotMarketResponse is the response type for the Query/SpotMarket RPC method.
message QuerySpotMarketResponse {
  SpotMarket market = 1;
}

// QuerySpotOrderbookRequest is the request type for the Query/SpotOrderbook RPC method.
message QuerySpotOrderbookRequest {
  // Market ID for the market
  string market_id = 1;
  uint64 limit = 2;
}

// QuerySpotOrderbookResponse is the response type for the Query/SpotOrderbook RPC method.
message QuerySpotOrderbookResponse {
  repeated PriceLevel buys_price_level = 1;
  repeated PriceLevel sells_price_level = 2;
}

// QueryTraderSpotOrdersRequest is the request type for the Query/TraderSpotOrders RPC method.
message QueryTraderSpotOrdersRequest {
  // Market ID for the market
  string market_id = 1;
  // SubaccountID of the trader
  string subaccount_id = 2;
}

message TrimmedSpotLimitOrder {
  // price of the order
  string price = 1 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // quantity of the order
  string quantity = 2 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // the amount of the quantity remaining fillable
  string fillable = 3 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // true if the order is a buy
  bool isBuy = 4;
  string order_hash = 5;
}

// QueryTraderSpotOrdersResponse is the response type for the Query/TraderSpotOrders RPC method.
message QueryTraderSpotOrdersResponse {
  repeated TrimmedSpotLimitOrder orders = 1;
}


// QueryDerivativeOrderbookRequest is the request type for the Query/DerivativeOrderbook RPC method.
message QueryDerivativeOrderbookRequest {
  // Market ID for the market
  string market_id = 1;
  uint64 limit = 2;
}

// QueryDerivativeOrderbookResponse is the response type for the Query/DerivativeOrderbook RPC method.
message QueryDerivativeOrderbookResponse {
  repeated PriceLevel buys_price_level = 1;
  repeated PriceLevel sells_price_level = 2;
}

// QueryTraderDerivativeOrdersRequest is the request type for the Query/TraderDerivativeOrders RPC method.
message QueryTraderDerivativeOrdersRequest {
  // Market ID for the market
  string market_id = 1;
  // SubaccountID of the trader
  string subaccount_id = 2;
}

message TrimmedDerivativeLimitOrder {
  // price of the order
  string price = 1 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // quantity of the order
  string quantity = 2 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // margin of the order
  string margin = 3 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // the amount of the quantity remaining fillable
  string fillable = 4 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // true if the order is a buy
  bool isBuy = 5;
  string order_hash = 6;
}

// QueryTraderDerivativeOrdersResponse is the response type for the Query/TraderDerivativeOrders RPC method.
message QueryTraderDerivativeOrdersResponse {
  repeated TrimmedDerivativeLimitOrder orders = 1;
}

// QueryDerivativeMarketsRequest is the request type for the Query/DerivativeMarkets RPC method.
message QueryDerivativeMarketsRequest {
  // Status of the market, for convenience it is set to string - not enum
  string status = 1;
}

message PriceLevel {
  string price = 1 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  // quantity
  string quantity = 2 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
}

message PerpetualMarketState {
  PerpetualMarketInfo market_info = 1;
  PerpetualMarketFunding funding_info = 2;
}

message FullDerivativeMarket {
  DerivativeMarket market = 1;
  oneof info {
    PerpetualMarketState perpetual_info = 2;
    ExpiryFuturesMarketInfo futures_info = 3;
  }
  string mark_price = 4[
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
}

// QueryDerivativeMarketsResponse is the response type for the Query/DerivativeMarkets RPC method.
message QueryDerivativeMarketsResponse {
  repeated FullDerivativeMarket markets = 1;
}

// QueryDerivativeMarketRequest is the request type for the Query/DerivativeMarket RPC method.
message QueryDerivativeMarketRequest {
  // Market ID for the market
  string market_id = 1;
}

// QueryDerivativeMarketResponse is the response type for the Query/DerivativeMarket RPC method.
message QueryDerivativeMarketResponse {
  FullDerivativeMarket market = 1;
}

// QueryDerivativeMarketAddressRequest is the request type for the Query/DerivativeMarketAddress RPC method.
message QueryDerivativeMarketAddressRequest {
  // Market ID for the market
  string market_id = 1;
}

// QueryDerivativeMarketAddressResponse is the response type for the Query/DerivativeMarketAddress RPC method.
message QueryDerivativeMarketAddressResponse {
  // address for the market
  string address = 1;
  // subaccountID for the market
  string subaccount_id = 2;
}

// QuerySubaccountTradeNonceRequest is the request type for the Query/SubaccountTradeNonce RPC method.
message QuerySubaccountTradeNonceRequest {
  string subaccount_id = 1;
}

// QuerySubaccountPositionsRequest is the request type for the Query/SubaccountPositions RPC method.
message QuerySubaccountPositionsRequest {
  string subaccount_id = 1;
}

// QuerySubaccountOrderMetadataRequest is the request type for the Query/SubaccountOrderMetadata RPC method.
message QuerySubaccountOrderMetadataRequest {
  string subaccount_id = 1;
}

// QuerySubaccountPositionsResponse is the response type for the Query/SubaccountPositions RPC method.
message QuerySubaccountPositionsResponse {
  repeated DerivativePosition state = 1[(gogoproto.nullable) = false];
}

// QuerySubaccountOrderMetadataResponse is the response type for the Query/SubaccountOrderMetadata RPC method.
message QuerySubaccountOrderMetadataResponse {
  repeated SubaccountOrderbookMetadataWithMarket metadata = 1[(gogoproto.nullable) = false];
}

// QuerySubaccountTradeNonceResponse is the response type for the Query/SubaccountTradeNonce RPC method.
message QuerySubaccountTradeNonceResponse {
  uint32 nonce = 1;
}

// QueryModuleStateRequest is the request type for the Query/ExchangeModuleState RPC method.
message QueryModuleStateRequest {}

// QueryModuleStateResponse is the response type for the Query/ExchangeModuleState RPC method.
message QueryModuleStateResponse {
  GenesisState state = 1;
}

// QueryPositionsRequest is the request type for the Query/Positions RPC method.
message QueryPositionsRequest {}

// QueryPositionsResponse is the response type for the Query/Positions RPC method.
message QueryPositionsResponse {
  repeated DerivativePosition state = 1[(gogoproto.nullable) = false];
}

// QueryTradeRewardPointsRequest is the request type for the Query/TradeRewardPoints RPC method.
message QueryTradeRewardPointsRequest {
  repeated string accounts = 1;
  int64 pending_pool_timestamp = 2;
}

// QueryTradeRewardPointsResponse is the response type for the Query/TradeRewardPoints RPC method.
message QueryTradeRewardPointsResponse {
  repeated string account_trade_reward_points = 1 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
}

// QueryTradeRewardCampaignRequest is the request type for the Query/TradeRewardCampaign RPC method.
message QueryTradeRewardCampaignRequest {}

// QueryTradeRewardCampaignResponse is the response type for the Query/TradeRewardCampaign RPC method.
message QueryTradeRewardCampaignResponse {
  TradingRewardCampaignInfo trading_reward_campaign_info = 1;
  repeated CampaignRewardPool trading_reward_pool_campaign_schedule = 2;
  string total_trade_reward_points = 3 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  repeated CampaignRewardPool pending_trading_reward_pool_campaign_schedule = 4;
  repeated string pending_total_trade_reward_points = 5 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
}

// QueryIsRegisteredDMMRequest is the request type for the Query/IsRegisteredDMM RPC method.
message QueryIsRegisteredDMMRequest {
  string account = 1;
}

// QueryIsRegisteredDMMResponse is the response type for the Query/IsRegisteredDMM RPC method.
message QueryIsRegisteredDMMResponse {
  bool is_registered_dmm = 1;
}

// QueryRegisteredDMMsRequest is the request type for the Query/RegisteredDMMs RPC method.
message QueryRegisteredDMMsRequest {
}

// QueryRegisteredDMMsResponse is the response type for the Query/RegisteredDMMs RPC method.
message QueryRegisteredDMMsResponse {
  repeated string registered_dmms = 1;
}

// QueryFeeDiscountAccountInfoRequest is the request type for the Query/FeeDiscountAccountInfo RPC method.
message QueryFeeDiscountAccountInfoRequest {
  string account = 1;
}

// QueryFeeDiscountAccountInfoResponse is the response type for the Query/FeeDiscountAccountInfo RPC method.
message QueryFeeDiscountAccountInfoResponse {
  uint64 tier_level = 1;
  FeeDiscountTierInfo account_info = 2;
  FeeDiscountTierTTL account_ttl = 3;
}

// QueryFeeDiscountScheduleRequest is the request type for the Query/FeeDiscountSchedule RPC method.
message QueryFeeDiscountScheduleRequest {}

// QueryFeeDiscountScheduleResponse is the response type for the Query/FeeDiscountSchedule RPC method.
message QueryFeeDiscountScheduleResponse {
  FeeDiscountSchedule fee_discount_schedule = 1;
}

// QueryBalanceMismatchesRequest is the request type for the Query/QueryBalanceMismatches RPC method.
message QueryBalanceMismatchesRequest {
  int64 dust_factor = 1;
}

message BalanceMismatch {
  string subaccountId = 1;
  string denom = 2;
  string available = 3 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  string total = 4 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  string balance_hold = 5 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  string expected_total = 6 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  string difference = 7 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
}

// QueryBalanceMismatchesResponse is the response type for the Query/QueryBalanceMismatches RPC method.
message QueryBalanceMismatchesResponse {
  repeated BalanceMismatch balance_mismatches = 1;
}

// QueryBalanceWithBalanceHoldsRequest is the request type for the Query/QueryBalanceWithBalanceHolds RPC method.
message QueryBalanceWithBalanceHoldsRequest {}

message BalanceWithMarginHold {
  string subaccountId = 1;
  string denom = 2;
  string available = 3 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  string total = 4 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
  string balance_hold = 5 [
    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",
    (gogoproto.nullable) = false
  ];
}

// QueryBalanceWithBalanceHoldsResponse is the response type for the Query/QueryBalanceWithBalanceHolds RPC method.
message QueryBalanceWithBalanceHoldsResponse {
  repeated BalanceWithMarginHold balance_with_balance_holds = 1;
}

// QueryFeeDiscountTierStatisticsRequest is the request type for the Query/QueryFeeDiscountTierStatistics RPC method.
message QueryFeeDiscountTierStatisticsRequest {}

message TierStatistic {
  uint64 tier = 1;
  uint64 count = 2;
}

// QueryFeeDiscountTierStatisticsResponse is the response type for the Query/QueryFeeDiscountTierStatistics RPC method.
message QueryFeeDiscountTierStatisticsResponse {
  repeated TierStatistic statistics = 1;
}